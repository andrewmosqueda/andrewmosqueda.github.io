<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Simulation of Buck Converter using discrete PID in LTSPICE - Andrew Mosqueda</title><meta name="description" content="If you are in a hurry and want to immediately verify its function, download and unzipped the file below then run the buck.asc file in LTSPICE: Discrete PWM buck converter This article presents a LTSPICE simulation of a PWM buck converter controlled by a discrete&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://andrewmosqueda.github.io/simulation-of-buck-converter-using-discrete-pid-in-ltspice/"><link rel="alternate" type="application/atom+xml" href="https://andrewmosqueda.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://andrewmosqueda.github.io/feed.json"><meta property="og:title" content="Simulation of Buck Converter using discrete PID in LTSPICE"><meta property="og:site_name" content="Andrew Mosqueda - Andrew Mosqueda"><meta property="og:description" content="If you are in a hurry and want to immediately verify its function, download and unzipped the file below then run the buck.asc file in LTSPICE: Discrete PWM buck converter This article presents a LTSPICE simulation of a PWM buck converter controlled by a discrete&hellip;"><meta property="og:url" content="https://andrewmosqueda.github.io/simulation-of-buck-converter-using-discrete-pid-in-ltspice/"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--post-entry-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://andrewmosqueda.github.io/assets/css/style.css?v=eacb492672ba3c1641d647982de266ba"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://andrewmosqueda.github.io/simulation-of-buck-converter-using-discrete-pid-in-ltspice/"},"headline":"Simulation of Buck Converter using discrete PID in LTSPICE","datePublished":"2021-08-08T11:14","dateModified":"2021-08-15T22:08","description":"If you are in a hurry and want to immediately verify its function, download and unzipped the file below then run the buck.asc file in LTSPICE: Discrete PWM buck converter This article presents a LTSPICE simulation of a PWM buck converter controlled by a discrete&hellip;","author":{"@type":"Person","name":"Andrew Mosqueda"},"publisher":{"@type":"Organization","name":"Andrew Mosqueda"}}</script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://andrewmosqueda.github.io/">Andrew Mosqueda</a></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2021-08-21T10:32">August 21, 2021</time></div><div class="infobar__search"><form action="https://andrewmosqueda.github.io/search.html"><input type="search" name="q" placeholder="search..." aria-label="Search input"> <button type="submit" aria-label="Submit"><svg role="presentation" focusable="false" width="15px" height="14px"><use xlink:href="https://andrewmosqueda.github.io/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><header class="u-header post__header"><h1>Simulation of Buck Converter using discrete PID in LTSPICE</h1><div class="u-header__meta u-small"><img src="https://andrewmosqueda.github.io/media/website/andrew.jpg" loading="eager" class="u-header__avatar" alt="Andrew Mosqueda"><div><a href="https://andrewmosqueda.github.io/authors/andrew-mosqueda/" title="Andrew Mosqueda">Andrew Mosqueda</a> <time datetime="2021-08-08T11:14">August 8, 2021</time></div></div></header><div class="post__entry u-inner"><p>If you are in a hurry and want to immediately verify its function, download and unzipped the file below then run the buck.asc file in LTSPICE:</p><p><a href="https://andrewmosqueda.github.io/media/files/discrete_buck_converter.zip" target="_blank" rel="noopener noreferrer">Discrete PWM buck converter</a></p><figure class="post__image">Below left is the schematic on the buck.asc file and below right should be the result of the LTSPICE simulation.<br><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/discrete_buck_pwm.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/discrete_buck_pwm-2xl.jpg 1600w" alt="LTSPICE Digital PWM Buck Converter" width="1916" height="922"></figure><h2>Introduction</h2><p>This article presents a LTSPICE simulation of a PWM buck converter controlled by a discrete PID. The simulation result will be compared to the result of the actual implementation of a digitally controlled buck converter (<a href="https://andrewmosqueda.github.io/implementing-5v-to-33v-buck-converter-in-the-dspic33ch-curiosity-development-board/" target="_blank" rel="noopener noreferrer">Buck converter</a>). Below table is a comparison of the source code from the the actual implementation (DSPIC33 IC) and the components used in this LTSPICE simulation.</p><table style="border-collapse: collapse; width: 98.8593%;" border="1"><tbody><tr><td style="width: 49.2311%;"><strong>MPLAB (DSPIC33) Source Code</strong></td><td style="width: 56.8252%;"><strong>LTSPICE component / parameter</strong></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">PARAMETERS</span></p><p><span style="font-size: small;">#define target_voltage  3.3<br>#define reference       666.7*target_voltage + 17.6<br>#define p_gain          0.1<br>#define i_gain          0.05</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">PARAMETERS</span></p><p><span style="font-size: small;">.param target_voltage=3.3 p_gain=0.1 i_gain=0.05<br>.param reference=(666.7*target_voltage)+17.6</span></p></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">ANALOG TO DIGITAL CONVERSION</span></p><p><span style="font-size: small;">(use the default configuration of ADC)</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">ANALOG TO DISCRETE CONVERSION</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/ADC.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/ADC-2xl.jpg 1600w" alt="LTSPICE Analog to Digital Conversion" width="602" height="57"></figure></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">ERROR CALCULATION</span></p><p><span style="font-size: small;">n16_error = n16_reference - ADCBUF1;</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">ERROR CALCULATION</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_error_calculation.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_error_calculation-2xl.jpg 1600w" alt="LTSPICE Error calculation" width="602" height="57"></figure></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">INTEGRATION</span></p><p><span style="font-size: small;">n16_integrator_memory = n16_integrator_memory +<br> i_gain*n16_error;</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">INTEGRATION</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_integration.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_integration-2xl.jpg 1600w" alt="LTSPICE Discrete Integrator" width="601" height="127"></figure></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">PROPORTIONAL</span></p><p><span style="font-size: small;">n16_proportional = p_gain*n16_error;</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">PROPORTIONAL</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_proportional.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_proportional-2xl.jpg 1600w" alt="LTSPICE proportional computation" width="602" height="53"></figure></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">DUTY CYCLE</span></p><p><span style="font-size: small;">PG7DC = PG7PER - n16_integrator_memory<br> - n16_proportional;</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">DUTY CYCLE</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_duty_cycle.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_duty_cycle-2xl.jpg 1600w" alt="LTSPICE Duty Cycle" width="603" height="55"></figure></td></tr><tr><td style="width: 49.2311%;"><p><span style="text-decoration: underline;">PWM GENERATION</span></p><p><span style="font-size: small;">Configured in MCC PWM7, pwm freq=40kHz,<br>master clock frequency=8MHz</span></p></td><td style="width: 56.8252%;"><p><span style="text-decoration: underline;">PWM GENERATION</span></p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_pwm_setting.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_setting-2xl.jpg 1600w" alt="LTSPICE PWM Setting" width="400" height="47"></figure><br><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/LTSPICE_pwm_generator.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/LTSPICE_pwm_generator-2xl.jpg 1600w" alt="LTSPICE PWM Generator" width="712" height="123"></figure></td></tr></tbody></table><p>Note: I used the floor() function in LTSPICE to convert the values into discrete.</p><p> </p><h2>Result</h2><p>Below is the resulting waveform from 9.68ms to 10ms of the simulation. We can see that the on time width measured is 3.34ms which is only 16.5% duty cycle. </p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/ltspice_pwm_waveform.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform-2xl.jpg 1600w" alt="LTSPICE PWM waveform" width="943" height="603"></figure><p>In the <a href="https://andrewmosqueda.github.io/implementing-5v-to-33v-buck-converter-in-the-dspic33ch-curiosity-development-board/" target="_blank" rel="noopener noreferrer">actual</a> implementation, the duty cycle measured by the oscilloscope was 20%. Most likely cause why the actual implementation has higher duty cycle is that the MOSFET used in the actual implementation has a higher turn on resistance (BSS308PE Rdson=130mΩ@4.5V). The MOSFET (IRF7210) I used in the LTSPICE simulation has a Rdson of only 5mΩ. I changed the MOSFET to part number FDC5614P which has a Rdson value of  105mΩ and run the simulation again, the result below is now similar to the actual implementation.</p><figure class="post__image"><img loading="lazy" src="https://andrewmosqueda.github.io/media/posts/2/ltspice_pwm_waveform2-2.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-xs.jpg 300w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-sm.jpg 480w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-md.jpg 768w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-lg.jpg 1024w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-xl.jpg 1360w, https://andrewmosqueda.github.io/media/posts/2/responsive/ltspice_pwm_waveform2-2-2xl.jpg 1600w" alt="LTSPICE PWM Buck Converter waveform" width="942" height="598"><figcaption>PWM on pulse width increased with higher Rdson</figcaption></figure><h2>Conclusion</h2><p>It was demonstrated that discrete control of PWM can be simulated in LTSPICE that can generate similar result with an actual implementation. It is better if we use the right part model. For example, the Rdson has a big impact on the duty cycle.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on August 15, 2021</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio box"><img class="u-author__avatar" src="https://andrewmosqueda.github.io/media/website/andrew.jpg" loading="lazy" alt="Andrew Mosqueda"><div><h4 class="h6"><a href="https://andrewmosqueda.github.io/authors/andrew-mosqueda/" title="Andrew Mosqueda">Andrew Mosqueda</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://andrewmosqueda.github.io/implementing-a-discrete-integrator-in-ltspice/" class="post__nav__link" rel="prev"><div class="u-small">Previous Post<h5>How to implement a discrete integrator in LTSPICE</h5></div></a></div><div class="post__nav__next"><a href="https://andrewmosqueda.github.io/implementing-5v-to-33v-buck-converter-in-the-dspic33ch-curiosity-development-board/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Implementing 5V to 3.3V PWM Buck Converter in the DSPIC33CH Curiosity Development Board</h5></div></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related-wrap"><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://andrewmosqueda.github.io/implementing-5v-to-33v-buck-converter-in-the-dspic33ch-curiosity-development-board/" class="inverse">Implementing 5V to 3.3V PWM Buck Converter in the DSPIC33CH Curiosity Development Board</a></h4><time datetime="2021-08-08T16:12" class="u-small">August 8, 2021</time></figcaption></figure><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://andrewmosqueda.github.io/implementing-a-discrete-integrator-in-ltspice/" class="inverse">How to implement a discrete integrator in LTSPICE</a></h4><time datetime="2021-08-02T19:38" class="u-small">August 2, 2021</time></figcaption></figure></div></div></footer></article></main><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured</h3><ul class="featured__container"><li class="featured__item"><div><a href="https://andrewmosqueda.github.io/simulation-of-buck-converter-using-discrete-pid-in-ltspice/" class="featured__title">Simulation of Buck Converter using discrete PID in LTSPICE</a> <time class="u-small" datetime="2021-08-08T11:14">August 8, 2021</time></div></li></ul></section><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><a href="https://andrewmosqueda.github.io/authors/andrew-mosqueda/" class="authors__image-link"><img src="https://andrewmosqueda.github.io/media/website/andrew.jpg" alt="Andrew Mosqueda"></a><div><a href="https://andrewmosqueda.github.io/authors/andrew-mosqueda/" class="authors__title">Andrew Mosqueda</a> <span class="u-small">Post: 3</span></div></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://andrewmosqueda.github.io/">Andrew Mosqueda</a><nav><ul class="footer__nav"></ul></nav><div class="footer__follow"><a href="https://www.facebook.com/andrew.mosqueda" aria-label="Facebook"><svg><use xlink:href="https://andrewmosqueda.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://www.linkedin.com/in/alex-andrew-mosqueda-31197876/" aria-label="LinkedIn"><svg><use xlink:href="https://andrewmosqueda.github.io/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/channel/UCHcJ7jRLmntRZrI8h41y3Yg" aria-label="Youtube"><svg><use xlink:href="https://andrewmosqueda.github.io/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright"><p>andrewgs7311@gmail.com</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://andrewmosqueda.github.io/assets/js/scripts.min.js?v=3dc768003cc6d66c9e7bf0904e71d3e8"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>